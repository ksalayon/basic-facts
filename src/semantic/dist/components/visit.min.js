!function(b,y,e,k){"use strict";y=void 0!==y&&y.Math==Math?y:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")(),b.visit=b.fn.visit=function(u){var l,d=b.isFunction(this)?b(y):b(this),g=d.selector||"",f=(new Date).getTime(),m=[],p=u,v="string"==typeof p,h=[].slice.call(arguments,1);return d.each(function(){var o,r=b.isPlainObject(u)?b.extend(!0,{},b.fn.visit.settings,u):b.extend({},b.fn.visit.settings),n=r.error,e=r.namespace,t=e+"-module",i=b(this),s=b(),c=this,a=i.data(t);o={initialize:function(){r.count?o.store(r.key.count,r.count):r.id?o.add.id(r.id):r.increment&&"increment"!==v&&o.increment(),o.add.display(i),o.instantiate()},instantiate:function(){o.verbose("Storing instance of visit module",o),a=o,i.data(t,o)},destroy:function(){o.verbose("Destroying instance"),i.removeData(t)},increment:function(e){var t=+o.get.count()+1;e?o.add.id(e):(t>r.limit&&!r.surpass&&(t=r.limit),o.debug("Incrementing visits",t),o.store(r.key.count,t))},decrement:function(e){var t=+o.get.count()-1;e?o.remove.id(e):(o.debug("Removing visit"),o.store(r.key.count,t))},get:{count:function(){return+o.retrieve(r.key.count)||0},idCount:function(e){return(e=e||o.get.ids()).length},ids:function(e){var t=[];return"string"==typeof(e=e||o.retrieve(r.key.ids))&&(t=e.split(r.delimiter)),o.verbose("Found visited ID list",t),t},storageOptions:function(e){var t={};return r.expires&&(t.expires=r.expires),r.domain&&(t.domain=r.domain),r.path&&(t.path=r.path),t}},has:{visited:function(i,e){var n=!1;return e=e||o.get.ids(),i!==k&&e&&b.each(e,function(e,t){t==i&&(n=!0)}),n}},set:{count:function(e){o.store(r.key.count,e)},ids:function(e){o.store(r.key.ids,e)}},reset:function(){o.store(r.key.count,0),o.store(r.key.ids,null)},add:{id:function(e){var t=o.retrieve(r.key.ids),i=t===k||""===t?e:t+r.delimiter+e;o.has.visited(e)?o.debug("Unique content already visited, not adding visit",e,t):e===k?o.debug("ID is not defined"):(o.debug("Adding visit to unique content",e),o.store(r.key.ids,i)),o.set.count(o.get.idCount())},display:function(e){var t=b(e);0<t.length&&!b.isWindow(t[0])&&(o.debug("Updating visit count for element",t),s=0<s.length?s.add(t):t)}},remove:{id:function(i){var e=o.get.ids(),n=[];i!==k&&e!==k&&(o.debug("Removing visit to unique content",i,e),b.each(e,function(e,t){t!==i&&n.push(t)}),n=n.join(r.delimiter),o.store(r.key.ids,n)),o.set.count(o.get.idCount())}},check:{limit:function(e){e=e||o.get.count(),r.limit&&(e>=r.limit&&(o.debug("Pages viewed exceeded limit, firing callback",e,r.limit),r.onLimit.call(c,e)),o.debug("Limit not reached",e,r.limit),r.onChange.call(c,e)),o.update.display(e)}},update:{display:function(e){e=e||o.get.count(),0<s.length&&(o.debug("Updating displayed view count",s),s.html(e))}},store:function(e,t){var i=o.get.storageOptions(t);if("localstorage"==r.storageMethod&&y.localStorage!==k)y.localStorage.setItem(e,t),o.debug("Value stored using local storage",e,t);else{if(b.cookie===k)return void o.error(n.noCookieStorage);b.cookie(e,t,i),o.debug("Value stored using cookie",e,t,i)}e==r.key.count&&o.check.limit(t)},retrieve:function(e,t){var i;return"localstorage"==r.storageMethod&&y.localStorage!==k?i=y.localStorage.getItem(e):b.cookie!==k?i=b.cookie(e):o.error(n.noCookieStorage),"undefined"!=i&&"null"!=i&&i!==k&&null!==i||(i=k),i},setting:function(e,t){if(b.isPlainObject(e))b.extend(!0,r,e);else{if(t===k)return r[e];r[e]=t}},internal:function(e,t){if(o.debug("Changing internal",e,t),t===k)return o[e];b.isPlainObject(e)?b.extend(!0,o,e):o[e]=t},debug:function(){!r.silent&&r.debug&&(r.performance?o.performance.log(arguments):(o.debug=Function.prototype.bind.call(console.info,console,r.name+":"),o.debug.apply(console,arguments)))},verbose:function(){!r.silent&&r.verbose&&r.debug&&(r.performance?o.performance.log(arguments):(o.verbose=Function.prototype.bind.call(console.info,console,r.name+":"),o.verbose.apply(console,arguments)))},error:function(){r.silent||(o.error=Function.prototype.bind.call(console.error,console,r.name+":"),o.error.apply(console,arguments))},performance:{log:function(e){var t,i;r.performance&&(i=(t=(new Date).getTime())-(f||t),f=t,m.push({Name:e[0],Arguments:[].slice.call(e,1)||"",Element:c,"Execution Time":i})),clearTimeout(o.performance.timer),o.performance.timer=setTimeout(o.performance.display,500)},display:function(){var e=r.name+":",i=0;f=!1,clearTimeout(o.performance.timer),b.each(m,function(e,t){i+=t["Execution Time"]}),e+=" "+i+"ms",g&&(e+=" '"+g+"'"),1<d.length&&(e+=" ("+d.length+")"),(console.group!==k||console.table!==k)&&0<m.length&&(console.groupCollapsed(e),console.table?console.table(m):b.each(m,function(e,t){console.log(t.Name+": "+t["Execution Time"]+"ms")}),console.groupEnd()),m=[]}},invoke:function(n,e,t){var o,r,i,s=a;return e=e||h,t=c||t,"string"==typeof n&&s!==k&&(n=n.split(/[\. ]/),o=n.length-1,b.each(n,function(e,t){var i=e!=o?t+n[e+1].charAt(0).toUpperCase()+n[e+1].slice(1):n;if(b.isPlainObject(s[i])&&e!=o)s=s[i];else{if(s[i]!==k)return r=s[i],!1;if(!b.isPlainObject(s[t])||e==o)return s[t]!==k&&(r=s[t]),!1;s=s[t]}})),b.isFunction(r)?i=r.apply(t,e):r!==k&&(i=r),b.isArray(l)?l.push(i):l!==k?l=[l,i]:i!==k&&(l=i),r}},v?(a===k&&o.initialize(),o.invoke(p)):(a!==k&&a.invoke("destroy"),o.initialize())}),l!==k?l:this},b.fn.visit.settings={name:"Visit",debug:!1,verbose:!1,performance:!0,namespace:"visit",increment:!1,surpass:!1,count:!1,limit:!1,delimiter:"&",storageMethod:"localstorage",key:{count:"visit-count",ids:"visit-ids"},expires:30,domain:!1,path:"/",onLimit:function(){},onChange:function(){},error:{method:"The method you called is not defined",missingPersist:"Using the persist setting requires the inclusion of PersistJS",noCookieStorage:"The default storage cookie requires $.cookie to be included."}}}(jQuery,window,document);